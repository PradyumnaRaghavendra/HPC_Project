‚úì Initialized. View run at 
https://modal.com/apps/nikhilp0799/main/ap-2k38hPf2c1OchpWMTGN7qt
‚úì Created objects.
‚îú‚îÄ‚îÄ üî® Created mount 
‚îÇ   /Users/nikhilpandey/Self_Improving_AI/neu-self-improve-ai/week_06/modal_trai
‚îÇ   n_apo_only.py
‚îî‚îÄ‚îÄ üî® Created function train_apo_only.
üöÄ Starting pure Multi-Turn APO training on Modal (H100 GPU)...
Goal: Demonstrate RL works (even 1% improvement is success!)

============================================================
üîç REWARDS MODULE LOADED - VERSION 3.0 WITH PROPER WEBSHOP REWARDS
============================================================
Gym has been unmaintained since 2022 and does not support NumPy 2.0 amongst other critical functionality.
Please upgrade to Gymnasium, the maintained drop-in replacement of Gym, or contact the authors of your software and request that they upgrade.
Users of this version of Gym should be able to simply replace 'import gym' with 'import gymnasium as gym' in the vast majority of cases.
See the migration guide at https://gymnasium.farama.org/introduction/migration_guide/ for additional information.
================================================================================
PURE MULTI-TURN APO TRAINING (NO BC!)
================================================================================

Device: cuda
GPU: NVIDIA H100 80GB HBM3
Memory: 79.18 GB

Loading model: Qwen/Qwen2.5-3B-Instruct
/usr/local/lib/python3.10/site-packages/huggingface_hub/file_download.py:942: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
/usr/local/lib/python3.10/site-packages/huggingface_hub/file_download.py:942: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(

[1ADownloading shards:   0%|          | 0/2 [00:00<?, ?it/s]
[1ADownloading shards:  50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 1/2 [00:16<00:16, 16.27s/it]Downloading shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 2/2 [00:24<00:00, 11.45s/it]Downloading shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 2/2 [00:24<00:00, 12.17s/it]

[1ALoading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]
[1ALoading checkpoint shards:  50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 1/2 [00:02<00:02,  2.34s/it]Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 2/2 [00:03<00:00,  1.71s/it]Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 2/2 [00:03<00:00,  1.80s/it]
Model loaded: 3.09B parameters

Environment: 5 products

--------------------------------------------------------------------------------
Base Model Evaluation
--------------------------------------------------------------------------------
Base model - Success: 15.0%, Avg reward: 0.265

--------------------------------------------------------------------------------
Multi-Turn APO Training (50 episodes)
--------------------------------------------------------------------------------
Creating reference model (frozen copy of base model)...
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.

[1ALoading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]
[1ALoading checkpoint shards:  50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 1/2 [00:02<00:02,  2.44s/it]Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 2/2 [00:03<00:00,  1.78s/it]Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 2/2 [00:03<00:00,  1.88s/it]

  APO Episode 5/50 - Success: 0.0%, Avg reward: -0.000, Loss: 0.9490
  APO Episode 10/50 - Success: 0.0%, Avg reward: 0.050, Loss: 0.9765
  APO Episode 15/50 - Success: 6.7%, Avg reward: 0.167, Loss: 1.5648
  APO Episode 20/50 - Success: 5.0%, Avg reward: 0.105, Loss: 0.1560
  APO Episode 25/50 - Success: 4.0%, Avg reward: 0.036, Loss: 0.3336
  APO Episode 30/50 - Success: 3.3%, Avg reward: 0.007, Loss: 0.0029
  APO Episode 35/50 - Success: 2.9%, Avg reward: -0.037, Loss: 0.0462
  APO Episode 40/50 - Success: 2.5%, Avg reward: -0.042, Loss: 0.0143
  APO Episode 45/50 - Success: 2.2%, Avg reward: -0.058, Loss: 0.0002
  APO Episode 50/50 - Success: 2.0%, Avg reward: -0.062, Loss: 0.0137
APO training complete!

After APO - Success: 0.0%, Avg reward: -0.100

================================================================================
TRAINING SUMMARY
================================================================================
Base:      15.0% success, 0.265 reward
After APO: 0.0% success, -0.100 reward
APO Improvement: -15.0%

APO did not improve over base model
Change: -15.0 percentage points

Results summary:
{
  "base_success": 15.0,
  "apo_success": 0.0,
  "improvement": -15.0,
  "base_reward": 0.265,
  "apo_reward": -0.09999999999999995
}
Stopping app - local entrypoint completed.
‚úì App completed. View run at 
https://modal.com/apps/nikhilp0799/main/ap-2k38hPf2c1OchpWMTGN7qt
